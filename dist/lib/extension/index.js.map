{"version":3,"sources":["../lib/extension/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import EventEmitter from 'events';\nimport fs from 'fs';\nimport jsonfile from 'jsonfile';\nimport { Extensions, WorkspaceExtensions } from 'last-hit-types';\nimport net from 'net';\nimport path from 'path';\nimport {\n\tExtensionBrowserOperationEvent,\n\tExtensionDataTransmittedEvent,\n\tExtensionEvent,\n\tExtensionEventTypes,\n\tExtensionPointId,\n\tExtensionTestLogEvent,\n\tIExtensionEntryPointHelper,\n\tIExtensionEntryPointWrapper\n} from '../types';\nimport { URI } from '../utils/uri';\nimport { WorkspaceExtensionEntryPointWrapper } from './wrappers/workspace';\n\n// With Electron 2.x and node.js 8.x the \"natives\" module\n// can cause a native crash (see https://github.com/nodejs/node/issues/19891 and\n// https://github.com/electron/electron/issues/10905). To prevent this from\n// happening we essentially blocklist this module from getting loaded in any\n// extension by patching the node require() function.\n(() => {\n\tconst Module = require('module') as any;\n\tconst originalLoad = Module._load;\n\n\tModule._load = function(request: string) {\n\t\tif (request === 'natives') {\n\t\t\tthrow new Error(\n\t\t\t\t'Either the extension or a NPM dependency is using the \"natives\" node module which is unsupported as it can cause a crash of the extension host. Click [here](https://go.microsoft.com/fwlink/?linkid=871887) to find out more'\n\t\t\t);\n\t\t}\n\n\t\treturn originalLoad.apply(this, arguments);\n\t};\n})();\n\nclass ExtensionEntryPointHelper implements IExtensionEntryPointHelper {\n\tprivate extensionId: ExtensionPointId;\n\tprivate packageFolder: string | undefined;\n\tprivate inIDE: boolean;\n\n\tprivate extension: IExtensionEntryPointWrapper<any> | null = null;\n\n\tprivate emitter: EventEmitter = new EventEmitter();\n\n\tconstructor(options: { extensionId: ExtensionPointId; packageFolder: string; inIDE: boolean }) {\n\t\tconst { extensionId, packageFolder, inIDE } = options;\n\n\t\tthis.extensionId = extensionId;\n\t\tthis.packageFolder = packageFolder;\n\t\tthis.inIDE = !!inIDE;\n\t}\n\tprivate getExtensionId(): ExtensionPointId {\n\t\treturn this.extensionId;\n\t}\n\tprivate getPackageFolder(): string {\n\t\treturn this.packageFolder;\n\t}\n\tisInIDE(): boolean {\n\t\treturn this.inIDE;\n\t}\n\tonce(eventType: ExtensionEventTypes, handler: (value: any) => void): this {\n\t\tthis.emitter.once(eventType, handler);\n\t\treturn this;\n\t}\n\ton(eventType: ExtensionEventTypes, handler: (value: any) => void): this {\n\t\tthis.emitter.on(eventType, handler);\n\t\treturn this;\n\t}\n\toff(eventType: ExtensionEventTypes, handler: (value: any) => void): this {\n\t\tthis.emitter.off(eventType, handler);\n\t\treturn this;\n\t}\n\tprivate onMainProcessMessageReceived = (\n\t\tmessage: any,\n\t\tsendHandle: net.Socket | net.Server\n\t): void => {\n\t\tif (!message) {\n\t\t\tconsole.log('Empty message received, ignore.');\n\t\t\treturn;\n\t\t}\n\t\tconst data = message as ExtensionEvent;\n\t\tif (data.extensionId !== this.getExtensionId()) {\n\t\t\t// do nothing, return\n\t\t\treturn;\n\t\t}\n\t\tswitch (true) {\n\t\t\tcase data.extensionId && data.type === ExtensionEventTypes.DATA_TRANSMITTED:\n\t\t\t\tthis.extension.handle((data as ExtensionDataTransmittedEvent).data);\n\t\t\t\tbreak;\n\t\t\tcase data.extensionId && data.type === ExtensionEventTypes.BROWSER_OPERATION:\n\t\t\t\tthis.emitter.emit(\n\t\t\t\t\tExtensionEventTypes.BROWSER_OPERATION,\n\t\t\t\t\t(data as ExtensionBrowserOperationEvent).data\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.error('No extension type declared via message, ignore.');\n\t\t\t\tconsole.error(data);\n\t\t}\n\t};\n\tprivate onStartSuccessful() {\n\t\tprocess.send(\n\t\t\t{\n\t\t\t\ttype: ExtensionEventTypes.REGISTERED,\n\t\t\t\textensionId: this.getExtensionId()\n\t\t\t},\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\t(error: Error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.error('Failed to send registration message.');\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\tprivate onStartFailed(e: Error) {\n\t\tprocess.send(\n\t\t\t{\n\t\t\t\ttype: ExtensionEventTypes.REGISTERED,\n\t\t\t\textensionId: this.getExtensionId(),\n\t\t\t\terror: {\n\t\t\t\t\tname: e.name,\n\t\t\t\t\tmessage: e.message,\n\t\t\t\t\tstack: e.stack\n\t\t\t\t}\n\t\t\t},\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\t(error: Error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\tconsole.error(`Failed to start extension[${this.getExtensionId()}]`);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tconsole.error('Failed to send registration message.');\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\tasync activate() {\n\t\ttry {\n\t\t\tprocess.on('message', this.onMainProcessMessageReceived);\n\n\t\t\tconst packageFilename = path.join(this.getPackageFolder(), 'package.json');\n\t\t\tif (!fs.existsSync(packageFilename)) {\n\t\t\t\tthrow new Error(`Package file[${packageFilename}] not found.`);\n\t\t\t}\n\t\t\tif (!fs.statSync(packageFilename).isFile()) {\n\t\t\t\tthrow new Error(`Package file[${packageFilename}] is not a file.`);\n\t\t\t}\n\t\t\tlet { main } = jsonfile.readFileSync(packageFilename) as { main: string };\n\t\t\tif (!main) {\n\t\t\t\tmain = 'index.js';\n\t\t\t}\n\t\t\tlet mainfile = path.join(this.getPackageFolder(), main);\n\t\t\tif (!fs.existsSync(mainfile)) {\n\t\t\t\tthrow new Error(`Main entry file[${mainfile}] not found.`);\n\t\t\t}\n\t\t\tif (!fs.statSync(mainfile).isFile()) {\n\t\t\t\tthrow new Error(`Main entry file[${mainfile}] is not a file.`);\n\t\t\t}\n\t\t\tif (!path.isAbsolute(mainfile)) {\n\t\t\t\tmainfile = path.join(process.cwd(), mainfile);\n\t\t\t}\n\t\t\tconst module: URI = URI.file(mainfile);\n\t\t\tconst extension: IExtensionEntryPointWrapper<any> = this.createWrapper(\n\t\t\t\t(() => {\n\t\t\t\t\tconst extension = require(module.fsPath);\n\t\t\t\t\tif (extension && extension.default) {\n\t\t\t\t\t\treturn extension.default;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn extension;\n\t\t\t\t\t}\n\t\t\t\t})()\n\t\t\t);\n\t\t\tawait extension.activate();\n\t\t\tthis.extension = extension;\n\t\t\tthis.onStartSuccessful();\n\t\t} catch (e) {\n\t\t\tthis.onStartFailed(e);\n\t\t\treturn Promise.reject();\n\t\t}\n\t}\n\tcreateWrapper(entrypoint: Extensions.IExtensionEntryPoint): IExtensionEntryPointWrapper<any> {\n\t\tswitch (entrypoint.getType()) {\n\t\t\tcase 'workspace':\n\t\t\t\treturn new WorkspaceExtensionEntryPointWrapper(\n\t\t\t\t\tentrypoint as WorkspaceExtensions.IWorkspaceExtensionEntryPoint,\n\t\t\t\t\tthis\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Extension type[${entrypoint.getType()}] is not supported.`);\n\t\t}\n\t}\n\tsendBrowserOperation(\n\t\tdata: {\n\t\t\ttype: Extensions.BrowserOperationEventTypes;\n\t\t} & { [key in string]: any }\n\t): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tprocess.send(\n\t\t\t\t{\n\t\t\t\t\textensionId: this.extensionId,\n\t\t\t\t\ttype: ExtensionEventTypes.BROWSER_OPERATION,\n\t\t\t\t\tdata\n\t\t\t\t} as ExtensionBrowserOperationEvent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t(error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\tsendTestLog(title: string, passed: boolean, level: number, message?: string): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tprocess.send(\n\t\t\t\t{\n\t\t\t\t\textensionId: this.extensionId,\n\t\t\t\t\ttype: ExtensionEventTypes.TEST_LOG,\n\t\t\t\t\tdata: { title, passed, level, message }\n\t\t\t\t} as ExtensionTestLogEvent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t(error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\tsendMessage(data: any): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tprocess.send(\n\t\t\t\t{\n\t\t\t\t\textensionId: this.extensionId,\n\t\t\t\t\ttype: ExtensionEventTypes.DATA_TRANSMITTED,\n\t\t\t\t\tdata\n\t\t\t\t} as ExtensionDataTransmittedEvent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t(error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\tsendIgnore(): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tprocess.send(\n\t\t\t\t{\n\t\t\t\t\textensionId: this.extensionId,\n\t\t\t\t\ttype: ExtensionEventTypes.DATA_TRANSMITTED,\n\t\t\t\t\tdata: { ignored: true }\n\t\t\t\t} as ExtensionDataTransmittedEvent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t(error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\tsendError(error: Error): Promise<void> {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tprocess.send(\n\t\t\t\t{\n\t\t\t\t\textensionId: this.extensionId,\n\t\t\t\t\ttype: ExtensionEventTypes.DATA_TRANSMITTED,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\terror: {\n\t\t\t\t\t\t\tname: error.name,\n\t\t\t\t\t\t\tmessage: error.message,\n\t\t\t\t\t\t\tstack: error.stack\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} as ExtensionDataTransmittedEvent,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\t(error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n}\n\nexport const activate = async (options: {\n\textensionId: ExtensionPointId;\n\tpackageFolder: string;\n\tinIDE: boolean;\n}): Promise<void> => {\n\tnew ExtensionEntryPointHelper(options).activate();\n};\n"]}