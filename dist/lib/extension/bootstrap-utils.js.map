{"version":3,"sources":["../lib/extension/bootstrap-utils.ts"],"names":[],"mappings":"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","file":"bootstrap-utils.js","sourcesContent":["// increase number of stack frames(from 10, https://github.com/v8/v8/wiki/Stack-Trace-API)\nError.stackTraceLimit = 100;\n\n//#region Add support for redirecting the loading of node modules\nexport const injectNodeModuleLookupPath = (injectPath: string): void => {\n\tif (!injectPath) {\n\t\tthrow new Error('Missing injectPath');\n\t}\n\n\t// @ts-ignore\n\tconst Module = require('module');\n\tconst path = require('path');\n\n\tconst nodeModulesPath = path.join(__dirname, '../node_modules');\n\n\t// @ts-ignore\n\tconst originalResolveLookupPaths = Module._resolveLookupPaths;\n\n\t// @ts-ignore\n\tModule._resolveLookupPaths = function(moduleName, parent) {\n\t\tconst paths = originalResolveLookupPaths(moduleName, parent);\n\t\tfor (let i = 0, len = paths.length; i < len; i++) {\n\t\t\tif (paths[i] === nodeModulesPath) {\n\t\t\t\tpaths.splice(i, 0, injectPath);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn paths;\n\t};\n};\n//#endregion\n\n//#region URI helpers\nexport const uriFromPath = (aPath: string): string => {\n\tconst path = require('path');\n\n\tlet pathName = path.resolve(aPath).replace(/\\\\/g, '/');\n\tif (pathName.length > 0 && pathName.charAt(0) !== '/') {\n\t\tpathName = '/' + pathName;\n\t}\n\n\t/** @type {string} */\n\tlet uri: string;\n\tif (process.platform === 'win32' && pathName.startsWith('//')) {\n\t\t// specially handle Windows UNC paths\n\t\turi = encodeURI('file:' + pathName);\n\t} else {\n\t\turi = encodeURI('file://' + pathName);\n\t}\n\n\treturn uri.replace(/#/g, '%23');\n};\n//#endregion\n\n//#region FS helpers\nexport const readFile = (file: string): Promise<string> => {\n\tconst fs = require('fs');\n\n\treturn new Promise(function(resolve, reject) {\n\t\tfs.readFile(file, 'utf8', function(err, data) {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresolve(data);\n\t\t});\n\t});\n};\n\n/**\n * @param {string} file\n * @param {string} content\n * @returns {Promise<void>}\n */\nexports.writeFile = function(file, content) {\n\tconst fs = require('fs');\n\n\treturn new Promise(function(resolve, reject) {\n\t\tfs.writeFile(file, content, 'utf8', function(err) {\n\t\t\tif (err) {\n\t\t\t\treject(err);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresolve();\n\t\t});\n\t});\n};\n\nconst mkdir = (dir: string): Promise<string> => {\n\tconst fs = require('fs');\n\n\treturn new Promise((resolve, reject) =>\n\t\tfs.mkdir(dir, (err: Error) =>\n\t\t\terr && (err as any).code !== 'EEXIST' ? reject(err) : resolve(dir)\n\t\t)\n\t);\n};\n\nconst mkdirp = (dir: string): Promise<string> => {\n\tconst path = require('path');\n\n\treturn mkdir(dir).then(null, (err: Error) => {\n\t\tif (err && (err as any).code === 'ENOENT') {\n\t\t\tconst parent = path.dirname(dir);\n\n\t\t\tif (parent !== dir) {\n\t\t\t\t// if not arrived at root\n\t\t\t\treturn mkdirp(parent).then(() => mkdir(dir));\n\t\t\t}\n\t\t}\n\n\t\tthrow err;\n\t});\n};\n//#endregion\n"]}